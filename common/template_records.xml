<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>
	<!-- Templated Windows -->
	<windowclass name="record_window">
		<frame>recordsheet</frame>
		<placement>
			<size width="400" height="500" />
		</placement>
		<sizelimits>
			<minimum width="350" height="350" />
			<dynamic />
		</sizelimits>
		<minimize>minimized_reference</minimize>
		<sharable />
		<tooltip field="name" />
		<script file="common/scripts/record_window.lua" />
		<sheetdata>
			<windowmenubar_recordsheet name="menubar" />

			<anchor_content_recordsheet_top name="contentanchor" />
			<anchor_content_recordsheet_bottom name="bottomanchor" />

			<!-- NOTE: Legacy override short term for layout -->
			<sub_content_framed_groupbox_top name="header">
				<anchored to="contentanchor">
					<left offset="10" />
					<right offset="-10" />
					<top relation="relative" offset="10" postoffset="10" />
				</anchored>
				<frame name="groupbox" offset="10,10,10,10" />
				<class>record_header</class>
			</sub_content_framed_groupbox_top>

			<sub_content_framed_groupbox name="content" />
			<scrollbar_content />

			<resize_recordsheet />
		</sheetdata>
	</windowclass>
	<windowclass name="ability_window">
		<frame>recordsheet</frame>
		<placement>
			<size width="400" height="500" />
		</placement>
		<sizelimits>
			<minimum width="350" height="350" />
			<dynamic />
		</sizelimits>
		<minimize>minimized_reference</minimize>
		<sharable />
		<tooltip field="name" />
		<script file="common/scripts/record_window.lua" />
		<sheetdata>
			<windowmenubar_recordsheet name="menubar" />

			<anchor_content_recordsheet_top name="contentanchor" />
			<anchor_content_recordsheet_bottom name="bottomanchor" />

			<!-- NOTE: Legacy override short term for layout -->
			<sub_content_framed_groupbox_top name="header">
				<anchored to="contentanchor">
					<left offset="10" />
					<right offset="-10" />
					<top relation="relative" offset="10" postoffset="10" />
				</anchored>
				<frame name="groupbox" offset="10,10,10,10" />
				<class>record_header</class>
			</sub_content_framed_groupbox_top>

			<power_roll name="abilityroll">
				<!-- <anchored to="header" /> -->
				<bounds>27,50,30,30</bounds>
				<tooltip textres="tooltip_pr" />
				<script file="common/scripts/power_roll_button.lua" />
			</power_roll>

			<sub_content_framed_groupbox name="content" />
			<scrollbar_content />

			<resize_recordsheet />
		</sheetdata>
	</windowclass>
	<windowclass name="record_window_tabbed">
		<frame>recordsheet</frame>
		<placement>
			<size width="400" height="500" />
		</placement>
		<sizelimits>
			<minimum width="350" height="350" />
			<dynamic />
		</sizelimits>
		<minimize>minimized_reference</minimize>
		<sharable />
		<tooltip field="name" />
		<script file="common/scripts/record_window_tabbed.lua" />
		<sheetdata>
			<windowmenubar_recordsheet name="menubar" />
			<resize_recordsheet />

			<anchor_content_recordsheet_tabbed_top name="contentanchor" />
			<anchor_content_recordsheet_bottom name="bottomanchor" />

			<!-- NOTE: Legacy override short term for layout -->
			<sub_content_framed_groupbox_top name="header">
				<anchored to="contentanchor">
					<left offset="10" />
					<right offset="-10" />
					<top relation="relative" offset="10" postoffset="10" />
				</anchored>
				<frame name="groupbox" offset="10,10,10,10" />
				<class>record_header</class>
			</sub_content_framed_groupbox_top>
		</sheetdata>
	</windowclass>
	<windowclass name="record_window_text" copy="record_window">
		<sheetdata>
			<sub_content_framed_groupbox name="content">
				<class>record_content_text</class>
			</sub_content_framed_groupbox>
		</sheetdata>
	</windowclass>
	<windowclass name="record_window_text_string" copy="record_window">
		<sheetdata>
			<sub_content_framed_groupbox name="content">
				<class>record_content_text_string</class>
			</sub_content_framed_groupbox>
		</sheetdata>
	</windowclass>

	<windowclass name="record_window_story">
		<frame>storybox</frame>
		<placement>
			<size width="400" height="650" />
		</placement>
		<sizelimits>
			<minimum width="350" height="350" />
			<dynamic />
		</sizelimits>
		<minimize>minimized_note</minimize>
		<sharable />
		<tooltip field="name" />
		<script file="common/scripts/record_window.lua" />
		<sheetdata>
			<windowmenubar_storybox name="menubar" />

			<anchor_content_storybox_top name="contentanchor" />
			<anchor_content_storybox_bottom name="bottomanchor" />

			<!-- NOTE: Legacy override short term for layout -->
			<sub_content_framed_groupbox_top name="header">
				<anchored to="contentanchor">
					<left offset="10" />
					<right offset="-10" />
					<top relation="relative" offset="10" postoffset="10" />
				</anchored>
				<frame name="groupbox" offset="10,10,10,10" />
				<class>record_header_story</class>
			</sub_content_framed_groupbox_top>

			<sub_content_framed_groupbox_bottom name="sub_paging">
				<anchored height="30" />
				<class>record_paging_story</class>
			</sub_content_framed_groupbox_bottom>

			<sub_content_framed_groupbox name="content">
				<class>record_content_story</class>
			</sub_content_framed_groupbox>
			<scrollbar_content />

			<resize_storybox />
		</sheetdata>
	</windowclass>
	<windowclass name="record_window_story" merge="join">
		<script file="campaign/scripts/story.lua" />
	</windowclass>
	<windowclass name="record_paging_story">
		<sheetdata>
			<button_content_page_top>
				<anchored>
					<top anchor="center" offset="-10" />
					<left anchor="center" offset="-10" />
				</anchored>
				<script>
					function onButtonPress()
						WindowManager.callOuterWindowFunction(window, "handlePageTop");
						return true;
					end
				</script>
			</button_content_page_top>
			<button_content_page_prev>
				<anchored>
					<top anchor="center" offset="-10" />
					<right anchor="center" offset="-40" />
				</anchored>
				<script>
					function onButtonPress()
						WindowManager.callOuterWindowFunction(window, "handlePagePrev");
						return true;
					end
				</script>
			</button_content_page_prev>
			<button_content_page_next>
				<anchored>
					<top anchor="center" offset="-10" />
					<left anchor="center" offset="40" />
				</anchored>
				<script>
					function onButtonPress()
						WindowManager.callOuterWindowFunction(window, "handlePageNext");
						return true;
					end
				</script>
			</button_content_page_next>
		</sheetdata>
	</windowclass>

	<!-- Templated Headers -->
	<windowclass name="record_header">
		<margins control="0,0,0,5" />
		<script file="common/scripts/record_header.lua" />
		<sheetdata>
			<anchor_content_record_header_top />
			<anchor_content_record_header_left />
			<anchor_content_record_header_right />
			<icon_record_header_type name="recordtype" />
			<string_record_header_name name="name" />
		</sheetdata>
	</windowclass>
	<windowclass name="record_header_token" copy="record_header">
		<sheetdata>
			<picture_record_header name="token" insertbefore="name" />
		</sheetdata>
	</windowclass>
	<windowclass name="record_header_id">
		<margins control="0,0,0,5" />
		<script file="common/scripts/record_header.lua" />
		<sheetdata>
			<anchor_content_record_header_top />
			<anchor_content_record_header_left />
			<anchor_content_record_header_right />
			<icon_record_header_type name="recordtype" />
			<string_record_header_name name="name" />
			<string_record_header_name name="nonid_name" />
		</sheetdata>
	</windowclass>
	<windowclass name="record_header_id_token" copy="record_header_id">
		<sheetdata>
			<picture_record_header name="token" insertbefore="name" />
		</sheetdata>
	</windowclass>

	<windowclass name="record_header_story">
		<margins control="0,0,0,5" />
		<script file="common/scripts/record_header.lua" />
		<sheetdata>
			<anchor_content_record_header_top />
			<anchor_content_record_header_left />
			<anchor_content_record_header_right />
			<icon_record_header_type name="recordtype" />
			<string_record_header_name_story name="name" />
		</sheetdata>
	</windowclass>

	<!-- Templated Content -->
	<windowclass name="record_context_text_base">
		<script file="common/scripts/record_content_text.lua" />
		<sheetdata>
			<anchor_content_top />
		</sheetdata>
	</windowclass>
	<windowclass name="record_content_text" copy="record_context_text_base">
		<sheetdata>
			<ft_content_noframe_noscroll_top name="text" />
		</sheetdata>
	</windowclass>
	<windowclass name="record_content_notes" copy="record_context_text_base">
		<target>notes</target>
		<sheetdata>
			<ft_content_noframe_noscroll_top name="notes" />
		</sheetdata>
	</windowclass>

	<windowclass name="record_content_abilities" copy="record_context_text_base">
		<script file="campaign/scripts/monster_abilities.lua" />
		<target>abilities</target>
		<!-- First Ability -->
		<sheetdata name="sheetdata_ability">
		<anchor_column name="columnanchor" />
			<basicstring name="abilityname_ability">
				<font>recordsheet_header</font>
				<anchored>
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="7" />
					<left offset="60" />
					<right offset="-5" />
				</anchored>
				<multilinespacing>45</multilinespacing>
			</basicstring>

			<!-- KEYWORDS, TYPE, DISTANCE, TARGET FIELDS -->
			<label_column name="keywords_label">
				<static textres="ability_label_keywords" />
			</label_column>
			<string_columnh name="keywords">
				<script>
					function onValueChanged()
						WindowManager.callOuterWindowFunction(window, "onSummaryChanged");
					end
				</script>
			</string_columnh>

			<label_column name="type_label">
				<static textres="ability_label_type" />
			</label_column>
			<string_columnh name="type">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="distance_label">
				<static textres="ability_label_distance" />
			</label_column>
			<string_columnh name="distance">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="target_label">
				<static textres="ability_label_target" />
			</label_column>
			<string_columnh name="target">
				<delaykeyupdate />
			</string_columnh>

			<!-- POWER ROLL -->
		
			<label_column name="characteristic_label">
				<static textres="ability_label_powerrollplus" />
				<anchored>
					<top offset="5" />
				</anchored>
			</label_column>

			<button_characteristic name="characteristic" source="ability.characteristic.button">
                <anchored width="20" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="5" />
					<left offset="80" />
				</anchored>
                <default>1</default>
                <tooltip textres="skill_tooltip" />
            </button_characteristic>

			<label_column name="tier1_label">
				<static textres="ability_label_tier1" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier1" source="tier1">
			</string_columnh>

			<label_column name="tier2_label">
				<static textres="ability_label_tier2" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier2" source="tier2" />

			<label_column name="tier3_label">
				<static textres="ability_label_tier3" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier3" source="tier3" />

			<!-- OTHER -->
			<label_column name="trigger_label">
				<static textres="ability_label_trigger" />
			</label_column>
			<string_columnh name="trigger">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="effect_label">
				<static textres="ability_label_effect" />
			</label_column>
			<string_columnh name="effect" source="effect">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="special_label">
				<static textres="ability_label_special" />
			</label_column>
			<string_columnh name="special">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="ability_cost_label">
				<static textres="ability_label_cost" />
			</label_column>
			<number_columnh name="ability_cost">
				<hideonvalue>0</hideonvalue>
			</number_columnh>

			<label_column name="ability_cost_string_label">
				<static textres="ability_label_resource" />
			</label_column>
			<string_columnh name="ability_cost_string">
			</string_columnh>

			<!-- // power roll button -->
			<power_roll name="power_roll">
				<anchored to="abilityname_ability" height="40" width="40">
					<left offset="-50"/>
					<top offset="4"/>
				</anchored>
				<tooltip textres="tooltip_pr" />
				<script>	
					function action(draginfo)
						local nodeWin = window.getDatabaseNode();
						local sCharSheetID = DB.getPath(DB.getChild(nodeWin, '...'));
						local sNPCID = DB.getPath(DB.getChild(nodeWin, '.'));
						local NPCID = DB.findNode(sNPCID);
						local characteristic = DB.getValue(nodeWin, "ability.characteristic.button");

                        -- add the characteristic that is chosed for the skill
                        characteristicMod = 0;
                        -- AGL
                        if (characteristic == 1) then
                            characteristicMod = DB.getValue(NPCID, "mgt");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- REA
                        if (characteristic == 2) then
                            characteristicMod = DB.getValue(NPCID, "agl");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- INU
                        if (characteristic == 3) then
                            characteristicMod = DB.getValue(NPCID, "rea");
							if (characteristicMod == nil) then
								characteristicMod = 0;
							end
                        end
                        -- PRS
                        if (characteristic == 4) then
                            characteristicMod = DB.getValue(NPCID, "inu");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- MGT
                        if (characteristic == 5) then
                            characteristicMod = DB.getValue(NPCID, "prs");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end

						local abilityName = DB.getValue(nodeWin, "abilityname_ability", "");
						local abilityKeywords = DB.getValue(nodeWin, "keywords", "");
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local nodePC = ActorManager.getCreatureNode(rActor);

						local rRoll = { 
							sType = "dice", 
							sDesc = "" .. abilityName .. " \n(" .. abilityKeywords .. ")", 
							aDice = { "d10", "d10" },
							nMod = characteristicMod,
							t1 = DB.getValue(nodeWin, "tier1"),
							t2 = DB.getValue(nodeWin, "tier2"),
							t3 = DB.getValue(nodeWin, "tier3");
							effect = DB.getValue(nodeWin, "effect");
						};
						ActionsManager_DS.encodeDesktopMods(rRoll);
						ActionsManager.performAction(draginfo, rActor, rRoll);
						return true;
					end
					
					function onDragStart(button, x, y, draginfo)
						return action(draginfo);
					end

					function onButtonPress()
						return action();
					end
				</script>
			</power_roll>	

			<!-- Second Ability -->
			<line_column name="divider2" />

			<basicstring name="abilityname_ability_2">
				<font>recordsheet_header</font>
				<anchored>
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="7" />
					<left offset="60" />
					<right offset="-5" />
				</anchored>
				<multilinespacing>45</multilinespacing>
			</basicstring>

			<!-- KEYWORDS, TYPE, DISTANCE, TARGET FIELDS -->
			<label_column name="keywords_2_label">
				<static textres="ability_label_keywords" />
			</label_column>
			<string_columnh name="keywords_2">
				<script>
					function onValueChanged()
						WindowManager.callOuterWindowFunction(window, "onSummaryChanged");
					end
				</script>
			</string_columnh>

			<label_column name="type_2_label">
				<static textres="ability_label_type" />
			</label_column>
			<string_columnh name="type_2">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="distance_2_label">
				<static textres="ability_label_distance" />
			</label_column>
			<string_columnh name="distance_2">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="target_2_label">
				<static textres="ability_label_target" />
			</label_column>
			<string_columnh name="target_2">
				<delaykeyupdate />
			</string_columnh>
		
			<label_column name="characteristic_2_label">
				<static textres="ability_label_powerrollplus" />
				<anchored>
					<top offset="5" />
				</anchored>
			</label_column>

			<button_characteristic name="characteristic_2" source="ability.characteristic.button_2">
                <anchored width="20" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="5" />
					<left offset="80" />
				</anchored>
                <default>1</default>
                <tooltip textres="skill_tooltip" />
            </button_characteristic>

			<label_column name="tier1_2_label">
				<static textres="ability_label_tier1" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier1_2" source="tier1_2">
			</string_columnh>

			<label_column name="tier2_2_label">
				<static textres="ability_label_tier2" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier2_2" source="tier2_2" />

			<label_column name="tier3_2_label">
				<static textres="ability_label_tier3" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier3_2" source="tier3_2" />

			<!-- OTHER -->
			<label_column name="trigger_2_label">
				<static textres="ability_label_trigger" />
			</label_column>
			<string_columnh name="trigger_2">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="effect_2_label">
				<static textres="ability_label_effect" />
			</label_column>
			<string_columnh name="effect_2" source="effect_2">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="special_2_label">
				<static textres="ability_label_special" />
			</label_column>
			<string_columnh name="special_2">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="ability_cost_2_label">
				<static textres="ability_label_cost" />
			</label_column>
			<number_columnh name="ability_cost_2">
				<hideonvalue>0</hideonvalue>
			</number_columnh>

			<label_column name="ability_cost_string_2_label">
				<static textres="ability_label_resource" />
			</label_column>
			<string_columnh name="ability_cost_string_2">
			</string_columnh>

			<!-- // power roll button -->
			<power_roll name="power_roll_2">
				<anchored to="abilityname_ability_2" height="40" width="40">
					<left offset="-50"/>
					<top offset="4"/>
				</anchored>
				<tooltip textres="tooltip_pr" />
				<script>	
					function action(draginfo)
						local nodeWin = window.getDatabaseNode();
						local sCharSheetID = DB.getPath(DB.getChild(nodeWin, '...'));
						local sNPCID = DB.getPath(DB.getChild(nodeWin, '.'));
						local NPCID = DB.findNode(sNPCID);
						local characteristic = DB.getValue(nodeWin, "ability.characteristic.button_2");

                        -- add the characteristic that is chosed for the skill
                        characteristicMod = 0;
                        -- AGL
                        if (characteristic == 2) then
                            characteristicMod = DB.getValue(NPCID, "agl");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- REA
                        if (characteristic == 3) then
                            characteristicMod = DB.getValue(NPCID, "rea");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- INU
                        if (characteristic == 4) then
                            characteristicMod = DB.getValue(NPCID, "inu");
							if (characteristicMod == nil) then
								characteristicMod = 0;
							end
                        end
                        -- PRS
                        if (characteristic == 5) then
                            characteristicMod = DB.getValue(NPCID, "prs");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- MGT
                        if (characteristic == 1) then
                            characteristicMod = DB.getValue(NPCID, "mgt");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end

						local abilityName = DB.getValue(nodeWin, "abilityname_ability_2", "");
						local abilityKeywords = DB.getValue(nodeWin, "keywords_2", "");
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local nodePC = ActorManager.getCreatureNode(rActor);

						local rRoll = { 
							sType = "dice", 
							sDesc = "" .. abilityName .. " \n(" .. abilityKeywords .. ")", 
							aDice = { "d10", "d10" },
							nMod = characteristicMod,
							t1 = DB.getValue(nodeWin, "tier1"),
							t2 = DB.getValue(nodeWin, "tier2"),
							t3 = DB.getValue(nodeWin, "tier3");
							effect = DB.getValue(nodeWin, "effect_2");
						};
						ActionsManager_DS.encodeDesktopMods(rRoll);
						ActionsManager.performAction(draginfo, rActor, rRoll);
						return true;
					end
					
					function onDragStart(button, x, y, draginfo)
						return action(draginfo);
					end

					function onButtonPress()
						return action();
					end
				</script>
			</power_roll>

			<!-- Second Ability -->
			<line_column name="divider3" />

			<basicstring name="abilityname_ability_3">
				<font>recordsheet_header</font>
				<anchored>
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="7" />
					<left offset="60" />
					<right offset="-5" />
				</anchored>
				<multilinespacing>45</multilinespacing>
			</basicstring>

			<!-- KEYWORDS, TYPE, DISTANCE, TARGET FIELDS -->
			<label_column name="keywords_3_label">
				<static textres="ability_label_keywords" />
			</label_column>
			<string_columnh name="keywords_3">
				<script>
					function onValueChanged()
						WindowManager.callOuterWindowFunction(window, "onSummaryChanged");
					end
				</script>
			</string_columnh>

			<label_column name="type_3_label">
				<static textres="ability_label_type" />
			</label_column>
			<string_columnh name="type_3">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="distance_3_label">
				<static textres="ability_label_distance" />
			</label_column>
			<string_columnh name="distance_3">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="target_3_label">
				<static textres="ability_label_target" />
			</label_column>
			<string_columnh name="target_3">
				<delaykeyupdate />
			</string_columnh>
		
			<label_column name="characteristic_3_label">
				<static textres="ability_label_powerrollplus" />
				<anchored>
					<top offset="5" />
				</anchored>
			</label_column>

			<button_characteristic name="characteristic_3" source="ability.characteristic.button_3">
                <anchored width="20" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="5" />
					<left offset="80" />
				</anchored>
                <default>1</default>
                <tooltip textres="skill_tooltip" />
            </button_characteristic>

			<label_column name="tier1_3_label">
				<static textres="ability_label_tier1" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier1_3" source="tier1_3">
			</string_columnh>

			<label_column name="tier2_3_label">
				<static textres="ability_label_tier2" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier2_3" source="tier2_3" />

			<label_column name="tier3_3_label">
				<static textres="ability_label_tier3" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier3_3" source="tier3_3" />

			<!-- OTHER -->
			<label_column name="trigger_3_label">
				<static textres="ability_label_trigger" />
			</label_column>
			<string_columnh name="trigger_3">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="effect_3_label">
				<static textres="ability_label_effect" />
			</label_column>
			<string_columnh name="effect_3" source="effect_3">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="special_3_label">
				<static textres="ability_label_special" />
			</label_column>
			<string_columnh name="special_3">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="ability_cost_3_label">
				<static textres="ability_label_cost" />
			</label_column>
			<number_columnh name="ability_cost_3">
				<hideonvalue>0</hideonvalue>
			</number_columnh>

			<label_column name="ability_cost_string_3_label">
				<static textres="ability_label_resource" />
			</label_column>
			<string_columnh name="ability_cost_string_3">
			</string_columnh>

			<!-- // power roll button -->
			<power_roll name="power_roll_3">
				<anchored to="abilityname_ability_3" height="40" width="40">
					<left offset="-50"/>
					<top offset="4"/>
				</anchored>
				<tooltip textres="tooltip_pr" />
				<script>	
					function action(draginfo)
						local nodeWin = window.getDatabaseNode();
						local sCharSheetID = DB.getPath(DB.getChild(nodeWin, '...'));
						local sNPCID = DB.getPath(DB.getChild(nodeWin, '.'));
						local NPCID = DB.findNode(sNPCID);
						local characteristic = DB.getValue(nodeWin, "ability.characteristic.button_3");

                        -- add the characteristic that is chosed for the skill
                        characteristicMod = 0;
                        -- AGL
                        if (characteristic == 2) then
                            characteristicMod = DB.getValue(NPCID, "agl");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- REA
                        if (characteristic == 3) then
                            characteristicMod = DB.getValue(NPCID, "rea");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- INU
                        if (characteristic == 4) then
                            characteristicMod = DB.getValue(NPCID, "inu");
							if (characteristicMod == nil) then
								characteristicMod = 0;
							end
                        end
                        -- PRS
                        if (characteristic == 5) then
                            characteristicMod = DB.getValue(NPCID, "prs");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- MGT
                        if (characteristic == 1) then
                            characteristicMod = DB.getValue(NPCID, "mgt");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end

						local abilityName = DB.getValue(nodeWin, "abilityname_ability_3", "");
						local abilityKeywords = DB.getValue(nodeWin, "keywords_3", "");
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local nodePC = ActorManager.getCreatureNode(rActor);

						local rRoll = { 
							sType = "dice", 
							sDesc = "" .. abilityName .. " \n(" .. abilityKeywords .. ")", 
							aDice = { "d10", "d10" },
							nMod = characteristicMod,
							t1 = DB.getValue(nodeWin, "tier1"),
							t2 = DB.getValue(nodeWin, "tier2"),
							t3 = DB.getValue(nodeWin, "tier3");
							effect = DB.getValue(nodeWin, "effect_3");
						};
						ActionsManager_DS.encodeDesktopMods(rRoll);
						ActionsManager.performAction(draginfo, rActor, rRoll);
						return true;
					end
					
					function onDragStart(button, x, y, draginfo)
						return action(draginfo);
					end

					function onButtonPress()
						return action();
					end
				</script>
			</power_roll>

						<!-- Second Ability -->
			<line_column name="divider4" />

			<basicstring name="abilityname_ability_4">
				<font>recordsheet_header</font>
				<anchored>
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="7" />
					<left offset="60" />
					<right offset="-5" />
				</anchored>
				<multilinespacing>45</multilinespacing>
			</basicstring>

			<!-- KEYWORDS, TYPE, DISTANCE, TARGET FIELDS -->
			<label_column name="keywords_4_label">
				<static textres="ability_label_keywords" />
			</label_column>
			<string_columnh name="keywords_4">
				<script>
					function onValueChanged()
						WindowManager.callOuterWindowFunction(window, "onSummaryChanged");
					end
				</script>
			</string_columnh>

			<label_column name="type_4_label">
				<static textres="ability_label_type" />
			</label_column>
			<string_columnh name="type_4">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="distance_4_label">
				<static textres="ability_label_distance" />
			</label_column>
			<string_columnh name="distance_4">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="target_4_label">
				<static textres="ability_label_target" />
			</label_column>
			<string_columnh name="target_4">
				<delaykeyupdate />
			</string_columnh>
		
			<label_column name="characteristic_4_label">
				<static textres="ability_label_powerrollplus" />
				<anchored>
					<top offset="5" />
				</anchored>
			</label_column>

			<button_characteristic name="characteristic_4" source="ability.characteristic.button_4">
                <anchored width="20" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="5" />
					<left offset="80" />
				</anchored>
                <default>1</default>
                <tooltip textres="skill_tooltip" />
            </button_characteristic>

			<label_column name="tier1_4_label">
				<static textres="ability_label_tier1" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier1_4" source="tier1_4">
			</string_columnh>

			<label_column name="tier2_4_label">
				<static textres="ability_label_tier2" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier2_4" source="tier2_4" />

			<label_column name="tier3_4_label">
				<static textres="ability_label_tier3" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier3_4" source="tier3_4" />

			<!-- OTHER -->
			<label_column name="trigger_4_label">
				<static textres="ability_label_trigger" />
			</label_column>
			<string_columnh name="trigger_4">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="effect_4_label">
				<static textres="ability_label_effect" />
			</label_column>
			<string_columnh name="effect_4" source="effect_4">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="special_4_label">
				<static textres="ability_label_special" />
			</label_column>
			<string_columnh name="special_4">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="ability_cost_4_label">
				<static textres="ability_label_cost" />
			</label_column>
			<number_columnh name="ability_cost_4">
				<hideonvalue>0</hideonvalue>
			</number_columnh>

			<label_column name="ability_cost_string_4_label">
				<static textres="ability_label_resource" />
			</label_column>
			<string_columnh name="ability_cost_string_4">
			</string_columnh>

			<!-- // power roll button -->
			<power_roll name="power_roll_4">
				<anchored to="abilityname_ability_4" height="40" width="40">
					<left offset="-50"/>
					<top offset="4"/>
				</anchored>
				<tooltip textres="tooltip_pr" />
				<script>	
					function action(draginfo)
						local nodeWin = window.getDatabaseNode();
						local sCharSheetID = DB.getPath(DB.getChild(nodeWin, '...'));
						local sNPCID = DB.getPath(DB.getChild(nodeWin, '.'));
						local NPCID = DB.findNode(sNPCID);
						local characteristic = DB.getValue(nodeWin, "ability.characteristic.button_4");

                        -- add the characteristic that is chosed for the skill
                        characteristicMod = 0;
                        -- AGL
                        if (characteristic == 2) then
                            characteristicMod = DB.getValue(NPCID, "agl");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- REA
                        if (characteristic == 3) then
                            characteristicMod = DB.getValue(NPCID, "rea");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- INU
                        if (characteristic == 4) then
                            characteristicMod = DB.getValue(NPCID, "inu");
							if (characteristicMod == nil) then
								characteristicMod = 0;
							end
                        end
                        -- PRS
                        if (characteristic == 5) then
                            characteristicMod = DB.getValue(NPCID, "prs");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- MGT
                        if (characteristic == 1) then
                            characteristicMod = DB.getValue(NPCID, "mgt");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end

						local abilityName = DB.getValue(nodeWin, "abilityname_ability_4", "");
						local abilityKeywords = DB.getValue(nodeWin, "keywords_4", "");
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local nodePC = ActorManager.getCreatureNode(rActor);

						local rRoll = { 
							sType = "dice", 
							sDesc = "" .. abilityName .. " \n(" .. abilityKeywords .. ")", 
							aDice = { "d10", "d10" },
							nMod = characteristicMod,
							t1 = DB.getValue(nodeWin, "tier1"),
							t2 = DB.getValue(nodeWin, "tier2"),
							t3 = DB.getValue(nodeWin, "tier3");
							effect = DB.getValue(nodeWin, "effect_4");
						};
						ActionsManager_DS.encodeDesktopMods(rRoll);
						ActionsManager.performAction(draginfo, rActor, rRoll);
						return true;
					end
					
					function onDragStart(button, x, y, draginfo)
						return action(draginfo);
					end

					function onButtonPress()
						return action();
					end
				</script>
			</power_roll>

						<!-- Second Ability -->
			<line_column name="divider5" />

			<basicstring name="abilityname_ability_5">
				<font>recordsheet_header</font>
				<anchored>
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="7" />
					<left offset="60" />
					<right offset="-5" />
				</anchored>
				<multilinespacing>45</multilinespacing>
			</basicstring>

			<!-- KEYWORDS, TYPE, DISTANCE, TARGET FIELDS -->
			<label_column name="keywords_5_label">
				<static textres="ability_label_keywords" />
			</label_column>
			<string_columnh name="keywords_5">
				<script>
					function onValueChanged()
						WindowManager.callOuterWindowFunction(window, "onSummaryChanged");
					end
				</script>
			</string_columnh>

			<label_column name="type_5_label">
				<static textres="ability_label_type" />
			</label_column>
			<string_columnh name="type_5">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="distance_5_label">
				<static textres="ability_label_distance" />
			</label_column>
			<string_columnh name="distance_5">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="target_5_label">
				<static textres="ability_label_target" />
			</label_column>
			<string_columnh name="target_5">
				<delaykeyupdate />
			</string_columnh>
		
			<label_column name="characteristic_5_label">
				<static textres="ability_label_powerrollplus" />
				<anchored>
					<top offset="5" />
				</anchored>
			</label_column>

			<button_characteristic name="characteristic_5" source="ability.characteristic.button_5">
                <anchored width="20" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="5" />
					<left offset="80" />
				</anchored>
                <default>1</default>
                <tooltip textres="skill_tooltip" />
            </button_characteristic>

			<label_column name="tier1_5_label">
				<static textres="ability_label_tier1" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier1_5" source="tier1_5">
			</string_columnh>

			<label_column name="tier2_5_label">
				<static textres="ability_label_tier2" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier2_5" source="tier2_5" />

			<label_column name="tier3_5_label">
				<static textres="ability_label_tier3" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier3_5" source="tier3_5" />

			<!-- OTHER -->
			<label_column name="trigger_5_label">
				<static textres="ability_label_trigger" />
			</label_column>
			<string_columnh name="trigger_5">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="effect_5_label">
				<static textres="ability_label_effect" />
			</label_column>
			<string_columnh name="effect_5" source="effect_5">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="special_5_label">
				<static textres="ability_label_special" />
			</label_column>
			<string_columnh name="special_5">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="ability_cost_5_label">
				<static textres="ability_label_cost" />
			</label_column>
			<number_columnh name="ability_cost_5">
				<hideonvalue>0</hideonvalue>
			</number_columnh>

			<label_column name="ability_cost_string_5_label">
				<static textres="ability_label_resource" />
			</label_column>
			<string_columnh name="ability_cost_string_5">
			</string_columnh>

			<!-- // power roll button -->
			<power_roll name="power_roll_5">
				<anchored to="abilityname_ability_5" height="40" width="40">
					<left offset="-50"/>
					<top offset="4"/>
				</anchored>
				<tooltip textres="tooltip_pr" />
				<script>	
					function action(draginfo)
						local nodeWin = window.getDatabaseNode();
						local sCharSheetID = DB.getPath(DB.getChild(nodeWin, '...'));
						local sNPCID = DB.getPath(DB.getChild(nodeWin, '.'));
						local NPCID = DB.findNode(sNPCID);
						local characteristic = DB.getValue(nodeWin, "ability.characteristic.button_5");

                        -- add the characteristic that is chosed for the skill
                        characteristicMod = 0;
                        -- AGL
                        if (characteristic == 2) then
                            characteristicMod = DB.getValue(NPCID, "agl");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- REA
                        if (characteristic == 3) then
                            characteristicMod = DB.getValue(NPCID, "rea");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- INU
                        if (characteristic == 4) then
                            characteristicMod = DB.getValue(NPCID, "inu");
							if (characteristicMod == nil) then
								characteristicMod = 0;
							end
                        end
                        -- PRS
                        if (characteristic == 5) then
                            characteristicMod = DB.getValue(NPCID, "prs");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- MGT
                        if (characteristic == 1) then
                            characteristicMod = DB.getValue(NPCID, "mgt");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end

						local abilityName = DB.getValue(nodeWin, "abilityname_ability_5", "");
						local abilityKeywords = DB.getValue(nodeWin, "keywords_5", "");
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local nodePC = ActorManager.getCreatureNode(rActor);

						local rRoll = { 
							sType = "dice", 
							sDesc = "" .. abilityName .. " \n(" .. abilityKeywords .. ")", 
							aDice = { "d10", "d10" },
							nMod = characteristicMod,
							t1 = DB.getValue(nodeWin, "tier1"),
							t2 = DB.getValue(nodeWin, "tier2"),
							t3 = DB.getValue(nodeWin, "tier3");
							effect = DB.getValue(nodeWin, "effect_5");
						};
						ActionsManager_DS.encodeDesktopMods(rRoll);
						ActionsManager.performAction(draginfo, rActor, rRoll);
						return true;
					end
					
					function onDragStart(button, x, y, draginfo)
						return action(draginfo);
					end

					function onButtonPress()
						return action();
					end
				</script>
			</power_roll>

						<!-- Second Ability -->
			<line_column name="divider6" />

			<basicstring name="abilityname_ability_6">
				<font>recordsheet_header</font>
				<anchored>
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="7" />
					<left offset="60" />
					<right offset="-5" />
				</anchored>
				<multilinespacing>45</multilinespacing>
			</basicstring>

			<!-- KEYWORDS, TYPE, DISTANCE, TARGET FIELDS -->
			<label_column name="keywords_6_label">
				<static textres="ability_label_keywords" />
			</label_column>
			<string_columnh name="keywords_6">
				<script>
					function onValueChanged()
						WindowManager.callOuterWindowFunction(window, "onSummaryChanged");
					end
				</script>
			</string_columnh>

			<label_column name="type_6_label">
				<static textres="ability_label_type" />
			</label_column>
			<string_columnh name="type_6">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="distance_6_label">
				<static textres="ability_label_distance" />
			</label_column>
			<string_columnh name="distance_6">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="target_6_label">
				<static textres="ability_label_target" />
			</label_column>
			<string_columnh name="target_6">
				<delaykeyupdate />
			</string_columnh>
		
			<label_column name="characteristic_6_label">
				<static textres="ability_label_powerrollplus" />
				<anchored>
					<top offset="5" />
				</anchored>
			</label_column>

			<button_characteristic name="characteristic_6" source="ability.characteristic.button_6">
                <anchored width="20" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="5" />
					<left offset="80" />
				</anchored>
                <default>1</default>
                <tooltip textres="skill_tooltip" />
            </button_characteristic>

			<label_column name="tier1_6_label">
				<static textres="ability_label_tier1" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier1_6" source="tier1_6">
			</string_columnh>

			<label_column name="tier2_6_label">
				<static textres="ability_label_tier2" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier2_6" source="tier2_6" />

			<label_column name="tier3_6_label">
				<static textres="ability_label_tier3" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier3_6" source="tier3_6" />

			<!-- OTHER -->
			<label_column name="trigger_6_label">
				<static textres="ability_label_trigger" />
			</label_column>
			<string_columnh name="trigger_6">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="effect_6_label">
				<static textres="ability_label_effect" />
			</label_column>
			<string_columnh name="effect_6" source="effect_6">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="special_6_label">
				<static textres="ability_label_special" />
			</label_column>
			<string_columnh name="special_6">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="ability_cost_6_label">
				<static textres="ability_label_cost" />
			</label_column>
			<number_columnh name="ability_cost_6">
				<hideonvalue>0</hideonvalue>
			</number_columnh>

			<label_column name="ability_cost_string_6_label">
				<static textres="ability_label_resource" />
			</label_column>
			<string_columnh name="ability_cost_string_6">
			</string_columnh>

			<!-- // power roll button -->
			<power_roll name="power_roll_6">
				<anchored to="abilityname_ability_6" height="40" width="40">
					<left offset="-50"/>
					<top offset="4"/>
				</anchored>
				<tooltip textres="tooltip_pr" />
				<script>	
					function action(draginfo)
						local nodeWin = window.getDatabaseNode();
						local sCharSheetID = DB.getPath(DB.getChild(nodeWin, '...'));
						local sNPCID = DB.getPath(DB.getChild(nodeWin, '.'));
						local NPCID = DB.findNode(sNPCID);
						local characteristic = DB.getValue(nodeWin, "ability.characteristic.button_6");

                        -- add the characteristic that is chosed for the skill
                        characteristicMod = 0;
                        -- AGL
                        if (characteristic == 2) then
                            characteristicMod = DB.getValue(NPCID, "agl");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- REA
                        if (characteristic == 3) then
                            characteristicMod = DB.getValue(NPCID, "rea");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- INU
                        if (characteristic == 4) then
                            characteristicMod = DB.getValue(NPCID, "inu");
							if (characteristicMod == nil) then
								characteristicMod = 0;
							end
                        end
                        -- PRS
                        if (characteristic == 5) then
                            characteristicMod = DB.getValue(NPCID, "prs");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- MGT
                        if (characteristic == 1) then
                            characteristicMod = DB.getValue(NPCID, "mgt");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end

						local abilityName = DB.getValue(nodeWin, "abilityname_ability_6", "");
						local abilityKeywords = DB.getValue(nodeWin, "keywords_6", "");
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local nodePC = ActorManager.getCreatureNode(rActor);

						local rRoll = { 
							sType = "dice", 
							sDesc = "" .. abilityName .. " \n(" .. abilityKeywords .. ")", 
							aDice = { "d10", "d10" },
							nMod = characteristicMod,
							t1 = DB.getValue(nodeWin, "tier1"),
							t2 = DB.getValue(nodeWin, "tier2"),
							t3 = DB.getValue(nodeWin, "tier3");
							effect = DB.getValue(nodeWin, "effect_6");
						};
						ActionsManager_DS.encodeDesktopMods(rRoll);
						ActionsManager.performAction(draginfo, rActor, rRoll);
						return true;
					end
					
					function onDragStart(button, x, y, draginfo)
						return action(draginfo);
					end

					function onButtonPress()
						return action();
					end
				</script>
			</power_roll>

						<!-- Second Ability -->
			<line_column name="divider7" />

			<basicstring name="abilityname_ability_7">
				<font>recordsheet_header</font>
				<anchored>
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="7" />
					<left offset="60" />
					<right offset="-5" />
				</anchored>
				<multilinespacing>45</multilinespacing>
			</basicstring>

			<!-- KEYWORDS, TYPE, DISTANCE, TARGET FIELDS -->
			<label_column name="keywords_7_label">
				<static textres="ability_label_keywords" />
			</label_column>
			<string_columnh name="keywords_7">
				<script>
					function onValueChanged()
						WindowManager.callOuterWindowFunction(window, "onSummaryChanged");
					end
				</script>
			</string_columnh>

			<label_column name="type_7_label">
				<static textres="ability_label_type" />
			</label_column>
			<string_columnh name="type_7">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="distance_7_label">
				<static textres="ability_label_distance" />
			</label_column>
			<string_columnh name="distance_7">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="target_7_label">
				<static textres="ability_label_target" />
			</label_column>
			<string_columnh name="target_7">
				<delaykeyupdate />
			</string_columnh>
		
			<label_column name="characteristic_7_label">
				<static textres="ability_label_powerrollplus" />
				<anchored>
					<top offset="5" />
				</anchored>
			</label_column>

			<button_characteristic name="characteristic_7" source="ability.characteristic.button_7">
                <anchored width="20" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="5" />
					<left offset="80" />
				</anchored>
                <default>1</default>
                <tooltip textres="skill_tooltip" />
            </button_characteristic>

			<label_column name="tier1_7_label">
				<static textres="ability_label_tier1" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier1_7" source="tier1_7">
			</string_columnh>

			<label_column name="tier2_7_label">
				<static textres="ability_label_tier2" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier2_7" source="tier2_7" />

			<label_column name="tier3_7_label">
				<static textres="ability_label_tier3" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier3_7" source="tier3_7" />

			<!-- OTHER -->
			<label_column name="trigger_7_label">
				<static textres="ability_label_trigger" />
			</label_column>
			<string_columnh name="trigger_7">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="effect_7_label">
				<static textres="ability_label_effect" />
			</label_column>
			<string_columnh name="effect_7" source="effect_7">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="special_7_label">
				<static textres="ability_label_special" />
			</label_column>
			<string_columnh name="special_7">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="ability_cost_7_label">
				<static textres="ability_label_cost" />
			</label_column>
			<number_columnh name="ability_cost_7">
				<hideonvalue>0</hideonvalue>
			</number_columnh>

			<label_column name="ability_cost_string_7_label">
				<static textres="ability_label_resource" />
			</label_column>
			<string_columnh name="ability_cost_string_7">
			</string_columnh>

			<!-- // power roll button -->
			<power_roll name="power_roll_7">
				<anchored to="abilityname_ability_7" height="40" width="40">
					<left offset="-50"/>
					<top offset="4"/>
				</anchored>
				<tooltip textres="tooltip_pr" />
				<script>	
					function action(draginfo)
						local nodeWin = window.getDatabaseNode();
						local sCharSheetID = DB.getPath(DB.getChild(nodeWin, '...'));
						local sNPCID = DB.getPath(DB.getChild(nodeWin, '.'));
						local NPCID = DB.findNode(sNPCID);
						local characteristic = DB.getValue(nodeWin, "ability.characteristic.button_7");

                        -- add the characteristic that is chosed for the skill
                        characteristicMod = 0;
                        -- AGL
                        if (characteristic == 2) then
                            characteristicMod = DB.getValue(NPCID, "agl");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- REA
                        if (characteristic == 3) then
                            characteristicMod = DB.getValue(NPCID, "rea");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- INU
                        if (characteristic == 4) then
                            characteristicMod = DB.getValue(NPCID, "inu");
							if (characteristicMod == nil) then
								characteristicMod = 0;
							end
                        end
                        -- PRS
                        if (characteristic == 5) then
                            characteristicMod = DB.getValue(NPCID, "prs");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- MGT
                        if (characteristic == 1) then
                            characteristicMod = DB.getValue(NPCID, "mgt");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end

						local abilityName = DB.getValue(nodeWin, "abilityname_ability_7", "");
						local abilityKeywords = DB.getValue(nodeWin, "keywords_7", "");
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local nodePC = ActorManager.getCreatureNode(rActor);

						local rRoll = { 
							sType = "dice", 
							sDesc = "" .. abilityName .. " \n(" .. abilityKeywords .. ")", 
							aDice = { "d10", "d10" },
							nMod = characteristicMod,
							t1 = DB.getValue(nodeWin, "tier1"),
							t2 = DB.getValue(nodeWin, "tier2"),
							t3 = DB.getValue(nodeWin, "tier3");
							effect = DB.getValue(nodeWin, "effect_7");
						};
						ActionsManager_DS.encodeDesktopMods(rRoll);
						ActionsManager.performAction(draginfo, rActor, rRoll);
						return true;
					end
					
					function onDragStart(button, x, y, draginfo)
						return action(draginfo);
					end

					function onButtonPress()
						return action();
					end
				</script>
			</power_roll>

						<!-- Second Ability -->
			<line_column name="divider8" />

			<basicstring name="abilityname_ability_8">
				<font>recordsheet_header</font>
				<anchored>
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="7" />
					<left offset="60" />
					<right offset="-5" />
				</anchored>
				<multilinespacing>45</multilinespacing>
			</basicstring>

			<!-- KEYWORDS, TYPE, DISTANCE, TARGET FIELDS -->
			<label_column name="keywords_8_label">
				<static textres="ability_label_keywords" />
			</label_column>
			<string_columnh name="keywords_8">
				<script>
					function onValueChanged()
						WindowManager.callOuterWindowFunction(window, "onSummaryChanged");
					end
				</script>
			</string_columnh>

			<label_column name="type_8_label">
				<static textres="ability_label_type" />
			</label_column>
			<string_columnh name="type_8">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="distance_8_label">
				<static textres="ability_label_distance" />
			</label_column>
			<string_columnh name="distance_8">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="target_8_label">
				<static textres="ability_label_target" />
			</label_column>
			<string_columnh name="target_8">
				<delaykeyupdate />
			</string_columnh>
		
			<label_column name="characteristic_8_label">
				<static textres="ability_label_powerrollplus" />
				<anchored>
					<top offset="5" />
				</anchored>
			</label_column>

			<button_characteristic name="characteristic_8" source="ability.characteristic.button_8">
                <anchored width="20" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="5" />
					<left offset="80" />
				</anchored>
                <default>1</default>
                <tooltip textres="skill_tooltip" />
            </button_characteristic>

			<label_column name="tier1_8_label">
				<static textres="ability_label_tier1" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier1_8" source="tier1_8">
			</string_columnh>

			<label_column name="tier2_8_label">
				<static textres="ability_label_tier2" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier2_8" source="tier2_8" />

			<label_column name="tier3_8_label">
				<static textres="ability_label_tier3" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier3_8" source="tier3_8" />

			<!-- OTHER -->
			<label_column name="trigger_8_label">
				<static textres="ability_label_trigger" />
			</label_column>
			<string_columnh name="trigger_8">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="effect_8_label">
				<static textres="ability_label_effect" />
			</label_column>
			<string_columnh name="effect_8" source="effect_8">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="special_8_label">
				<static textres="ability_label_special" />
			</label_column>
			<string_columnh name="special_8">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="ability_cost_8_label">
				<static textres="ability_label_cost" />
			</label_column>
			<number_columnh name="ability_cost_8">
				<hideonvalue>0</hideonvalue>
			</number_columnh>

			<label_column name="ability_cost_string_8_label">
				<static textres="ability_label_resource" />
			</label_column>
			<string_columnh name="ability_cost_string_8">
			</string_columnh>

			<!-- // power roll button -->
			<power_roll name="power_roll_8">
				<anchored to="abilityname_ability_8" height="40" width="40">
					<left offset="-50"/>
					<top offset="4"/>
				</anchored>
				<tooltip textres="tooltip_pr" />
				<script>	
					function action(draginfo)
						local nodeWin = window.getDatabaseNode();
						local sCharSheetID = DB.getPath(DB.getChild(nodeWin, '...'));
						local sNPCID = DB.getPath(DB.getChild(nodeWin, '.'));
						local NPCID = DB.findNode(sNPCID);
						local characteristic = DB.getValue(nodeWin, "ability.characteristic.button_8");

                        -- add the characteristic that is chosed for the skill
                        characteristicMod = 0;
                        -- AGL
                        if (characteristic == 2) then
                            characteristicMod = DB.getValue(NPCID, "agl");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- REA
                        if (characteristic == 3) then
                            characteristicMod = DB.getValue(NPCID, "rea");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- INU
                        if (characteristic == 4) then
                            characteristicMod = DB.getValue(NPCID, "inu");
							if (characteristicMod == nil) then
								characteristicMod = 0;
							end
                        end
                        -- PRS
                        if (characteristic == 5) then
                            characteristicMod = DB.getValue(NPCID, "prs");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- MGT
                        if (characteristic == 1) then
                            characteristicMod = DB.getValue(NPCID, "mgt");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end

						local abilityName = DB.getValue(nodeWin, "abilityname_ability_8", "");
						local abilityKeywords = DB.getValue(nodeWin, "keywords_8", "");
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local nodePC = ActorManager.getCreatureNode(rActor);

						local rRoll = { 
							sType = "dice", 
							sDesc = "" .. abilityName .. " \n(" .. abilityKeywords .. ")", 
							aDice = { "d10", "d10" },
							nMod = characteristicMod,
							t1 = DB.getValue(nodeWin, "tier1"),
							t2 = DB.getValue(nodeWin, "tier2"),
							t3 = DB.getValue(nodeWin, "tier3");
							effect = DB.getValue(nodeWin, "effect_8");
						};
						ActionsManager_DS.encodeDesktopMods(rRoll);
						ActionsManager.performAction(draginfo, rActor, rRoll);
						return true;
					end
					
					function onDragStart(button, x, y, draginfo)
						return action(draginfo);
					end

					function onButtonPress()
						return action();
					end
				</script>
			</power_roll>

						<!-- Second Ability -->
			<line_column name="divider9" />

			<basicstring name="abilityname_ability_9">
				<font>recordsheet_header</font>
				<anchored>
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="7" />
					<left offset="60" />
					<right offset="-5" />
				</anchored>
				<multilinespacing>45</multilinespacing>
			</basicstring>

			<!-- KEYWORDS, TYPE, DISTANCE, TARGET FIELDS -->
			<label_column name="keywords_9_label">
				<static textres="ability_label_keywords" />
			</label_column>
			<string_columnh name="keywords_9">
				<script>
					function onValueChanged()
						WindowManager.callOuterWindowFunction(window, "onSummaryChanged");
					end
				</script>
			</string_columnh>

			<label_column name="type_9_label">
				<static textres="ability_label_type" />
			</label_column>
			<string_columnh name="type_9">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="distance_9_label">
				<static textres="ability_label_distance" />
			</label_column>
			<string_columnh name="distance_9">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="target_9_label">
				<static textres="ability_label_target" />
			</label_column>
			<string_columnh name="target_9">
				<delaykeyupdate />
			</string_columnh>
		
			<label_column name="characteristic_9_label">
				<static textres="ability_label_powerrollplus" />
				<anchored>
					<top offset="5" />
				</anchored>
			</label_column>

			<button_characteristic name="characteristic_9" source="ability.characteristic.button_9">
                <anchored width="20" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="5" />
					<left offset="80" />
				</anchored>
                <default>1</default>
                <tooltip textres="skill_tooltip" />
            </button_characteristic>

			<label_column name="tier1_9_label">
				<static textres="ability_label_tier1" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier1_9" source="tier1_9">
			</string_columnh>

			<label_column name="tier2_9_label">
				<static textres="ability_label_tier2" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier2_9" source="tier2_9" />

			<label_column name="tier3_9_label">
				<static textres="ability_label_tier3" />
				<anchored>
					<left offset="36" />
				</anchored>
			</label_column>
			<string_columnh name="tier3_9" source="tier3_9" />

			<!-- OTHER -->
			<label_column name="trigger_9_label">
				<static textres="ability_label_trigger" />
			</label_column>
			<string_columnh name="trigger_9">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="effect_9_label">
				<static textres="ability_label_effect" />
			</label_column>
			<string_columnh name="effect_9" source="effect_9">
				<delaykeyupdate />
			</string_columnh>
			<label_column name="special_9_label">
				<static textres="ability_label_special" />
			</label_column>
			<string_columnh name="special_9">
				<delaykeyupdate />
			</string_columnh>

			<label_column name="ability_cost_9_label">
				<static textres="ability_label_cost" />
			</label_column>
			<number_columnh name="ability_cost_9">
				<hideonvalue>0</hideonvalue>
			</number_columnh>

			<label_column name="ability_cost_string_9_label">
				<static textres="ability_label_resource" />
			</label_column>
			<string_columnh name="ability_cost_string_9">
			</string_columnh>

			<!-- // power roll button -->
			<power_roll name="power_roll_9">
				<anchored to="abilityname_ability_9" height="40" width="40">
					<left offset="-50"/>
					<top offset="4"/>
				</anchored>
				<tooltip textres="tooltip_pr" />
				<script>	
					function action(draginfo)
						local nodeWin = window.getDatabaseNode();
						local sCharSheetID = DB.getPath(DB.getChild(nodeWin, '...'));
						local sNPCID = DB.getPath(DB.getChild(nodeWin, '.'));
						local NPCID = DB.findNode(sNPCID);
						local characteristic = DB.getValue(nodeWin, "ability.characteristic.button_9");

                        -- add the characteristic that is chosed for the skill
                        characteristicMod = 0;
                        -- AGL
                        if (characteristic == 2) then
                            characteristicMod = DB.getValue(NPCID, "agl");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- REA
                        if (characteristic == 3) then
                            characteristicMod = DB.getValue(NPCID, "rea");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- INU
                        if (characteristic == 4) then
                            characteristicMod = DB.getValue(NPCID, "inu");
							if (characteristicMod == nil) then
								characteristicMod = 0;
							end
                        end
                        -- PRS
                        if (characteristic == 5) then
                            characteristicMod = DB.getValue(NPCID, "prs");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end
                        -- MGT
                        if (characteristic == 1) then
                            characteristicMod = DB.getValue(NPCID, "mgt");
							if (characteristicMod == nill) then
								characteristicMod = 0;
							end
                        end

						local abilityName = DB.getValue(nodeWin, "abilityname_ability_9", "");
						local abilityKeywords = DB.getValue(nodeWin, "keywords_9", "");
						local rActor = ActorManager.resolveActor(window.getDatabaseNode());
						local nodePC = ActorManager.getCreatureNode(rActor);

						local rRoll = { 
							sType = "dice", 
							sDesc = "" .. abilityName .. " \n(" .. abilityKeywords .. ")", 
							aDice = { "d10", "d10" },
							nMod = characteristicMod,
							t1 = DB.getValue(nodeWin, "tier1"),
							t2 = DB.getValue(nodeWin, "tier2"),
							t3 = DB.getValue(nodeWin, "tier3");
							effect = DB.getValue(nodeWin, "effect_9");
						};
						ActionsManager_DS.encodeDesktopMods(rRoll);
						ActionsManager.performAction(draginfo, rActor, rRoll);
						return true;
					end
					
					function onDragStart(button, x, y, draginfo)
						return action(draginfo);
					end

					function onButtonPress()
						return action();
					end
				</script>
			</power_roll>

		</sheetdata>
	</windowclass>

	<windowclass name="record_content_description" copy="record_context_text_base">
		<target>description</target>
		<sheetdata>
			<ft_content_noframe_noscroll_top name="description" />
		</sheetdata>
	</windowclass>
	<windowclass name="record_content_text_string" copy="record_context_text_base">
		<sheetdata>
			<string_content_noframe_noscroll_top name="text">
				<empty textres="ft_empty" hidereadonly="true" />
			</string_content_noframe_noscroll_top>
		</sheetdata>
	</windowclass>

	<windowclass name="record_content_story" copy="record_context_text_base">
		<skipid />
		<sheetdata>
			<ft_content_noframe_noscroll_top name="text">
				<script>
					function onLinkActivated(sClass, sRecord)
						StoryManager.onLinkActivated(window, sClass, sRecord);
					end
				</script>
			</ft_content_noframe_noscroll_top>
		</sheetdata>
	</windowclass>

	<!-- Templates -->
	<template name="anchor_content_record_header_top">
		<genericcontrol name="contentanchor">
			<anchored height="0">
				<top offset="0" />
				<left offset="0" />
				<right offset="0" />
			</anchored>
			<disabled />
		</genericcontrol>
	</template>
	<template name="anchor_content_record_header_left">
		<genericcontrol name="leftanchor">
			<anchored to="contentanchor" height="0" width="0">
				<top relation="current" offset="5" />
				<left />
			</anchored>
		</genericcontrol>
	</template>
	<template name="anchor_content_record_header_right">
		<genericcontrol name="rightanchor">
			<anchored to="contentanchor" height="0" width="0">
				<top relation="current" offset="5" />
				<right />
			</anchored>
		</genericcontrol>
	</template>
	<template name="icon_record_header_base">
		<genericcontrol>
			<anchored to="leftanchor" width="20" height="20">
				<top offset="4" />
				<left relation="relative" offset="5" postoffset="5" />
			</anchored>
			<frame name="fieldlight" offset="5,5,5,5" />
		</genericcontrol>
	</template>
	<template name="icon_record_header_type">
		<icon_record_header_base>
			<invisible />
			<script>
				function onInit()
					self.updateDisplay();
				end
				function getRecordType()
					return WindowManager.getRecordType(window);
				end
				function updateDisplay()
					local sRecordType = self.getRecordType();
					if sRecordType ~= "" then
						local sIcon = "sidebar_icon_recordtype_" .. sRecordType;
						if Interface.isIcon(sIcon) then
							setIcon(sIcon);
						else
							setIcon("sidebar_icon_default");
						end
						local sFont = string.format("%s_header", WindowManager.getTopWindow(window).getFrame());
						if not Interface.isFont(sFont) then
							sFont = "recordsheet_header";
						end
						setColor(Interface.getFontColor(sFont));
						setTooltipText(LibraryData.getSingleDisplayText(sRecordType));
						setVisible(true);
					else
						setVisible(false);
					end
				end
			</script>
		</icon_record_header_base>
	</template>
	<template name="string_record_header_name">
		<string_content_base>
			<anchored>
				<left parent="leftanchor" relation="relative" offset="10" postoffset="10" />
				<right parent="rightanchor" relation="relative" offset="-10" postoffset="-10" />
				<top relation="relative" offset="5" postoffset="5" />
			</anchored>
			<font>recordsheet_header</font>
			<multilinespacing>28</multilinespacing>
			<nodrag />
			<delaykeyupdate />
			<script>
				function onValueChanged()
					WindowManager.callOuterWindowFunction(window, "onNameUpdated");
				end
			</script>
		</string_content_base>
	</template>
	<template name="string_record_header_name_image">
		<string_record_header_name>
			<anchored height="28">
				<top relation="current" offset="5" />
			</anchored>
			<font>imagebox_header</font>
			<multilinespacing merge="delete" />
		</string_record_header_name>
	</template>
	<template name="string_record_header_name_story">
		<string_record_header_name>
			<font>storybox_header</font>
			<multilinespacing>28</multilinespacing>
		</string_record_header_name>
	</template>
	<template name="area_content_record_header_details">
		<area_content_top name="area_details">
			<anchored height="20">
				<top offset="5" />
				<left offset="30" />
			</anchored>
		</area_content_top>
	</template>
	<template name="linkc_record_header">
		<linkcontrol_static>
			<anchored to="leftanchor" width="20" height="20">
				<top offset="4" />
				<left relation="relative" offset="2" postoffset="2" />
			</anchored>
		</linkcontrol_static>
	</template>
	<template name="toolbar_toggle_header_right">
		<toolbar_toggle_right>
			<anchored>
				<top offset="4" />
			</anchored>
			<initbyname />
		</toolbar_toggle_right>
	</template>
	<template name="toolbar_field_header_right">
		<toolbar_field_right>
			<anchored>
				<top offset="4" />
			</anchored>
			<initbyname />
		</toolbar_field_right>
	</template>
	<template name="toolbar_action_header_right">
		<toolbar_action_right>
			<anchored>
				<top offset="4" />
			</anchored>
			<initbyname />
		</toolbar_action_right>
	</template>

	<!-- Templates - Image -->
	<template name="spacer_record_name_image">
		<spacer_content_top>
			<anchored height="38" />
		</spacer_content_top>
	</template>
	<template name="anchor_content_image_left">
		<genericcontrol name="leftanchor">
			<anchored to="contentanchor" height="0" width="0">
				<top relation="current" />
				<left />
			</anchored>
		</genericcontrol>
	</template>
	<template name="anchor_content_image_right">
		<genericcontrol name="rightanchor">
			<anchored to="contentanchor" height="0" width="0">
				<top relation="current" />
				<right />
			</anchored>
		</genericcontrol>
	</template>
	<template name="image_record_step">
		<imagecontrol name="image">
			<default snap="on" />
			<script file="campaign/scripts/image.lua" />
		</imagecontrol>
	</template>
	<template name="imagedata_record_step">
		<imagedatacontrol>
			<invisible />
			<color>38331B</color>
			<backcolor>E6DFB8</backcolor>
		</imagedatacontrol>
	</template>
	<template name="image_content">
		<image_record_step>
			<anchored>
				<top parent="contentanchor" relation="current" />
				<bottom parent="bottomanchor" relation="current" />
				<left parent="leftanchor" relation="relative" />
				<right parent="rightanchor" relation="relative" />
			</anchored>
		</image_record_step>
	</template>
	<template name="imagedata_content">
		<imagedata_record_step>
			<anchored width="288">
				<top parent="contentanchor" relation="current" />
				<bottom parent="bottomanchor" relation="current" />
				<right parent="rightanchor" relation="relative" />
			</anchored>
		</imagedata_record_step>
	</template>
	<template name="sub_image_token_detail">
		<subwindow>
			<frame name="image_token_detail" />
		</subwindow>
	</template>
	<template name="sub_image_hover_token_detail">
		<sub_image_token_detail>
			<anchored to="image" position="insidetopright" offset="5,5" width="120" height="125" />
			<disabled />
		</sub_image_token_detail>
	</template>
	<template name="sub_image_view_token_detail">
		<sub_image_token_detail>
			<anchored to="image" width="120" height="125">
				<left anchor="center" offset="-60" />
				<bottom offset="-5" />
			</anchored>
		</sub_image_token_detail>
	</template>
	<template name="sub_image_camera_controls">
		<subwindow>
			<anchored to="image" position="insidebottomright" offset="2,2" width="129" height="64" />
			<frame name="image_token_detail" />
			<class>image_camera_controls</class>
		</subwindow>
	</template>
	<template name="button_image_camera_move">
		<button_icon>
			<anchored position="insidetopleft" />
			<tintable />
			<script>
				function onClickDown()
					local cImage = WindowManager.callOuterWindowFunction(self, "getImage");
					cImage.setFocus();
					WindowManager.callOuterWindowFunction(window, "onStartCameraDirection", direction[1]);
					return true;
				end
				function onClickRelease()
					WindowManager.callOuterWindowFunction(window, "onEndCameraDirection", direction[1]);
				end
				function onDragEnd()
					WindowManager.callOuterWindowFunction(window, "onEndCameraDirection", direction[1]);
				end
				function updateTooltip(sViewMode)
					if (sViewMode or "") == "" then
						setTooltipText(Interface.getString("image_tooltip_" .. direction[1]));
					else
						setTooltipText(Interface.getString("image_tooltip_" .. direction[1] .. "_viewcamera"));
					end
				end
			</script>
		</button_icon>
	</template>
	<template name="list_viewers">
		<genericcontrol>
			<anchored to="bottomanchor" position="aboveleft" />
			<portraitset>charlist</portraitset>
			<portraitspacing>22</portraitspacing>
			<script file="common/scripts/list_viewers.lua" />
		</genericcontrol>
	</template>

	<!-- Templates - Legacy -->
	<template name="subwindow_record">
		<subwindow>
			<anchored to="contentframe" position="over" />
		</subwindow>
	</template>
	<template name="scrollbar_record">
		<scrollbar>
			<anchored to="contentframe" />
		</scrollbar>
	</template>
	<template name="ft_record">
		<simpleft />
	</template>
	<template name="button_record_isidentified">
		<buttoncontrol name="isidentified">
			<anchored to="rightanchor" width="20" height="20">
				<top />
				<right anchor="left" relation="relative" offset="-5" />
			</anchored>
			<state icon="record_unidentified" tooltipres="tooltip_nonid" />
			<state icon="record_identified" tooltipres="tooltip_id" />
			<gmeditonly />
			<gmvisibleonly />
			<script file="common/scripts/button_record_isidentified.lua" />
		</buttoncontrol>
	</template>
	<template name="hidden_record_isidentified">
		<genericcontrol>
			<bounds>0,0,0,0</bounds>
			<invisible />
			<script file="common/scripts/hidden_record_isidentified.lua" />
		</genericcontrol>
	</template>
</root>
